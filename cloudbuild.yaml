
steps:
  - name: python
    entrypoint: pip
    args: [ "install", "-r", "requirements.txt", "--user" ]
  - name: python
    entrypoint: python
    args: [ "manage.py", "runserver", "8000", "&"]
  - name: 'gcr.io/cloud-builders/docker'
    args: [ 'build', '-t', 'europe-west9-docker.pkg.dev/$PROJECT_ID/oc-lettings-repo/oc-lettings-image:tag1', '.' ]
  - name: 'gcr.io/cloud-builders/docker'
    args: [ 'push', 'europe-west9-docker.pkg.dev/$PROJECT_ID/oc-lettings-repo/oc-lettings-image:tag1' ]
  - name: google/cloud-sdk
    args: [ 'gcloud', 'run', 'deploy', 'oc-lettings',
            '--image=europe-west9-docker.pkg.dev/${PROJECT_ID}/oc-lettings-repo/oc-lettings-image:tag1',
            '--region', 'europe-west9', '--platform', 'managed', '--port', '8080',
            '--allow-unauthenticated' ]
artifacts:
  objects:
    location: gs://oc-lettings_cloudbuild/
    paths:
      - ${SHORT_SHA}_test_log.xml
images:
  - 'europe-west9-docker.pkg.dev/$PROJECT_ID/oc-lettings-repo/oc-lettings-image:tag1'
